$(document).ready(function(){function e(){function e(e){console.log(e),$(".reservation-calendar .fc-day.selected").removeClass("selected"),$(".reservation-calendar .fc-day-number.selected").removeClass("selected");var t=$(".reservation-calendar").find('td[data-date="'+e+'"]');t.get(0).classList.add("selected"),$(t.get(1)).find("span").addClass("selected")}function t(e){c=e;var t=document.getElementById("reservation-calendar-selected-date"),n=document.getElementById("reservation-calendar-selected-date-placeholder-2");t&&n&&(e||(e=v.getDate()),t.innerText=moment(e).format("MMMM YYYY"),n.innerText=moment(e).format("dddd, MMMM DD"))}function n(e,t,n,a,o){$.ajax({type:"GET",url:"/fetch-time-slots.json?date="+t+"&slot="+e+"&profile="+n+"&time_zone="+a,success(e){u=e.off_days;var t=v.getDate(),n=moment(t).format("dddd");-1!==u.findIndex(function(e){return e===n})?o([]):o(e.slots_distribution)}})}function r(e){var t=document.createElement("div");return t.innerHTML=a,$(t).find(".time-slot-time").text(e),$(t).find(".reservation-continue-btn").on("click",function(t){t.preventDefault(),i(e)}),t}function i(e,t){if(m){var n=document.getElementById("reservation_guide_id").value,a=document.getElementById("reservation_goal").value,o=document.getElementById("edit_reservation").value,r=document.getElementById("booking_id").value,i=document.getElementById("reservation-duration-select").value,s=c||v.getDate(),d=document.getElementById("timeZoneSelect").value,l=e;$.ajax({type:"POST",url:"/session/confirm-schedule.js",data:{guide_id:n,goal:a,duration:i,start_time:l,date:s,time_zone:d,id:r,edit:o},success(e){t&&t(e)}})}}function s(e){$(".reservation-time-slots").html(e),$(e).find(".time-slot .btn-link").click(function(){$(".time-slot").removeClass("active"),$(this).parent().parent().addClass("active")})}function d(e,t,a,i){l();var d=document.getElementById("reservation_profile_id");if(d){var c=d.value;$("#loading").fadeIn(),n(e,t,c,a,function(e){var t=e.map(function(e){return r(moment(e[0]).format("hh:mma"))});t.length||(t=o),s(t),$("#loading").fadeOut(),i&&v.render()})}}function l(){var e=10*$("#reservation-duration-select").val();$(".reservation-cost").text(e);var t=$("#chest-container").text()-e;t<0?(m=!1,$("#remaining-container").addClass("c-red-500 font-weight-bold")):(m=!0,$("#remaining-container").removeClass("c-red-500 font-weight-bold")),$("#remaining-container").text(t)}if("bookings"===$("meta[name=psj]").attr("controller")){var c,m,u=[];if(d($("#reservation-duration-select").val(),moment().format("YYYY/MM/DD"),$("#timeZoneSelect").val(),!0),v=document.querySelector(".personal-very-custom-calendar")){v.childElementCount&&(v.innerHTML="");var v=new FullCalendar.Calendar(v,{plugins:["dayGrid","interaction","moment"],header:{left:"",center:"",right:""},aspectRatio:1,height:350,selectable:!0,unselectAuto:!1,dayRender:function(e){var t=moment(e.date);if(!t.isBefore(moment().subtract("1","day"))){var n=t.format("dddd");if(-1===u.findIndex(function(e){return e===n}))e.el.classList.add("valid-date"),e.el.parentElement.parentElement.parentElement.parentElement.nextElementSibling.querySelector('td[data-date="'+e.el.attributes["data-date"].value+'"] span').classList.add("valid-date")}},dateClick:function(t){var n;(n=moment(t.date)).isBefore(moment().subtract("1","day"))||-1!==u.findIndex(function(e){return e===n.format("dddd")})||($(".reservation-calendar .fc-day.selected").removeClass("selected"),$(".reservation-calendar .fc-day-number.selected").removeClass("selected"),e(n=$(t.dayEl).attr("data-date")))},select:function(n){var a=moment(n.start),o=moment(n.end),r=a.format("dddd");return console.log(this),o.isBefore(moment())||moment.utc(o.diff(a)).format("D")>2||-1!==u.findIndex(function(e){return e===r})?(v.unselect(),c&&v.select(c),!1):(t(n.start),d($("#reservation-duration-select").val(),moment(n.start).format("YYYY/MM/DD"),$("#timeZoneSelect").val()),e(a.format("YYYY-MM-DD")),!0)}});console.log(v),t(),new PerfectScrollbar(document.querySelector(".reservation-container")),new PerfectScrollbar(document.querySelector(".reservation-time-slots")),$("#reservation-duration-select").change(function(){var e=$(this).val(),t=c||v.getDate();d(e,moment(t).format("YYYY/MM/DD"),$("#timeZoneSelect").val())}),$("#timeZoneSelect").change(function(){var e=c||v.getDate();d($("#reservation-duration-select").val(),moment(e).format("YYYY/MM/DD"),$(this).val())}),$("#reservation-prev-month").click(function(){var e=v.getDate();moment(e).isBefore(moment())||(e=moment(e).subtract(1,"months"),v.gotoDate(e.format()),t(),(moment(e).subtract(1,"months").isBefore(moment(),"year")||moment(e).subtract(1,"months").isSame(moment(),"year")&&moment(e).subtract(1,"months").isBefore(moment(),"month"))&&$("#reservation-prev-month").attr("disabled",!0))}),$("#reservation-next-month").click(function(){$("#reservation-prev-month").attr("disabled",!1);var e=v.getDate();e=moment(e).add(1,"months"),v.gotoDate(e.format()),t()}),$(".time-slot .btn-link").click(function(){$(".time-slot").removeClass("active"),$(this).parent().parent().addClass("active")})}}}function t(e,t,n){var a;return function(){var o=this,r=arguments,i=function(){a=null,n||e.apply(o,r)},s=n&&!a;clearTimeout(a),a=setTimeout(i,t),s&&e.apply(o,r)}}var n=t(e,250),a='<div class="row mx-0 time-slot mb-2">             <div class="col px-0">              <button class="btn btn-link ff-ssp time-slot-time fsz-12">7:00am</button>            </div>            <div class="col pr-0 pl-1 btn-success-wrap">              <button class="btn btn-success ff-ssp fsz-12 reservation-continue-btn">Continue</button>            </div>          </div>',o='<h4 class="fsz-12">No slots are available</h4>';$(document).on("turbolinks:load",n),n()});